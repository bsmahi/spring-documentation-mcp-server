<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Navigation Fragment</title>
</head>
<body>

<!-- Navigation Bar Fragment -->
<nav th:fragment="navbar" class="navbar navbar-expand-lg sticky-top">
    <div class="container-fluid">
        <!-- Brand Logo -->
        <a class="navbar-brand" th:href="@{/}">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="navbar-brand-logo">
                <path fill="#6db33f" d="M16 0C7.164 0 0 7.164 0 16s7.164 16 16 16 16-7.164 16-16S24.836 0 16 0zm7.207 20.379c-.083.187-.19.36-.316.514-.413.505-1.043.808-1.722.808-.325 0-.632-.062-.911-.174-.652-.261-1.087-.848-1.087-1.522 0-.326.087-.632.239-.895.13-.217.304-.391.5-.53.435-.304.956-.478 1.522-.478.261 0 .522.043.761.13.674.239 1.174.804 1.304 1.522.044.239.044.478 0 .7-.043.174-.13.348-.217.478zm-7.207-2.087c-.522 0-.956-.217-1.348-.565-.435-.391-.652-.913-.652-1.478 0-.435.13-.848.348-1.174.261-.391.652-.7 1.13-.848.218-.065.435-.087.652-.087.565 0 1.087.196 1.522.565.391.348.609.848.609 1.391 0 .478-.152.913-.435 1.261-.326.413-.783.696-1.304.804-.196.043-.391.065-.609.065zm-3.783-5.913c-.174 0-.348-.022-.522-.087-.565-.174-1-.609-1.174-1.174-.043-.174-.065-.348-.065-.522 0-.565.239-1.087.652-1.435.348-.304.783-.478 1.261-.478.174 0 .348.022.522.065.565.152 1 .587 1.174 1.13.043.174.065.348.065.522 0 .565-.239 1.087-.652 1.435-.348.304-.783.478-1.261.478zm8.739 3.696c-.174 0-.348-.022-.522-.065-.565-.152-1-.587-1.174-1.13-.043-.174-.065-.348-.065-.522 0-.565.239-1.087.652-1.435.348-.304.783-.478 1.261-.478.174 0 .348.022.522.065.565.152 1 .587 1.174 1.13.043.174.065.348.065.522 0 .565-.239 1.087-.652 1.435-.348.304-.783.478-1.261.478z"/>
            </svg>
            <span>Spring MCP</span>
        </a>

        <!-- Mobile Toggle Button -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navigation Menu -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <!-- Main Navigation Links -->
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}" th:classappend="${#request.requestURI == '/' || #request.requestURI == '/dashboard'} ? 'active' : ''">
                        <i class="bi bi-house-door me-1"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/projects}" th:classappend="${#strings.contains(#request.requestURI, '/projects')} ? 'active' : ''">
                        <i class="bi bi-folder me-1"></i>Projects
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/versions}" th:classappend="${#strings.contains(#request.requestURI, '/versions')} ? 'active' : ''">
                        <i class="bi bi-tags me-1"></i>Versions
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/documentation}" th:classappend="${#strings.contains(#request.requestURI, '/documentation')} ? 'active' : ''">
                        <i class="bi bi-book me-1"></i>Documentation
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/examples}" th:classappend="${#strings.contains(#request.requestURI, '/examples')} ? 'active' : ''">
                        <i class="bi bi-code-square me-1"></i>Examples
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="toolsDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-tools me-1"></i>Tools
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="toolsDropdown">
                        <li>
                            <a class="dropdown-item" th:href="@{/external-sources}">
                                <i class="bi bi-link-45deg me-2"></i>External Sources
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" th:href="@{/mcp/status}">
                                <i class="bi bi-hdd-network me-2"></i>MCP Status
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" th:href="@{/logs}">
                                <i class="bi bi-journal-text me-2"></i>Logs
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" th:href="@{/settings}">
                                <i class="bi bi-gear me-2"></i>Settings
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>

            <!-- Right Side - User Menu -->
            <ul class="navbar-nav ms-auto">
                <!-- Search (Optional) -->
                <li class="nav-item me-3 d-none d-lg-block">
                    <form class="d-flex search-bar" role="search" th:action="@{/search}" method="get">
                        <i class="bi bi-search search-bar-icon"></i>
                        <input class="form-control form-control-sm" type="search" placeholder="Search..." aria-label="Search" name="q">
                    </form>
                </li>

                <!-- User Dropdown -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle me-1"></i>
                        <span class="navbar-user-name" sec:authentication="name">User</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li>
                            <h6 class="dropdown-header">
                                <span sec:authentication="name">User</span>
                            </h6>
                        </li>
                        <li>
                            <span class="dropdown-item-text text-muted small">
                                Role: <span sec:authentication="principal.authorities">ROLE_USER</span>
                            </span>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" th:href="@{/profile}">
                                <i class="bi bi-person me-2"></i>Profile
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" th:href="@{/settings}">
                                <i class="bi bi-gear me-2"></i>Settings
                            </a>
                        </li>
                        <!-- Admin-only links -->
                        <li sec:authorize="hasRole('ADMIN')">
                            <a class="dropdown-item" th:href="@{/users}">
                                <i class="bi bi-people me-2"></i>User Management
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form th:action="@{/logout}" method="post" class="d-inline">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="dropdown-item text-danger">
                                    <i class="bi bi-box-arrow-right me-2"></i>Logout
                                </button>
                            </form>
                        </li>
                    </ul>
                </li>

                <!-- Notifications (Optional) -->
                <li class="nav-item dropdown ms-2">
                    <a class="nav-link position-relative" href="#" id="notificationDropdown" role="button"
                       data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-bell"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                              th:if="${notificationCount != null && notificationCount > 0}">
                            <span th:text="${notificationCount}">0</span>
                            <span class="visually-hidden">unread notifications</span>
                        </span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown" style="min-width: 300px;">
                        <li>
                            <h6 class="dropdown-header">Notifications</h6>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li th:if="${notifications == null || #lists.isEmpty(notifications)}">
                            <span class="dropdown-item-text text-muted">No new notifications</span>
                        </li>
                        <li th:each="notification : ${notifications}">
                            <a class="dropdown-item" th:href="${notification.link}" th:if="${notifications != null}">
                                <div class="d-flex align-items-start">
                                    <i class="bi bi-info-circle me-2 mt-1" th:classappend="${notification.type}"></i>
                                    <div>
                                        <div class="fw-semibold" th:text="${notification.title}">Notification Title</div>
                                        <small class="text-muted" th:text="${notification.message}">Notification message</small>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li><hr class="dropdown-divider" th:if="${notifications != null && !#lists.isEmpty(notifications)}"></li>
                        <li>
                            <a class="dropdown-item text-center small" th:href="@{/notifications}">View All Notifications</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

</body>
</html>
