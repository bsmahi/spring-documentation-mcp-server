<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <title th:text="${user.username} + ' - Spring MCP Server'">User Details - Spring MCP Server</title>
</head>
<body>
<div layout:fragment="content">
    <!-- Page Header -->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item">
                        <a th:href="@{/users}" class="text-decoration-none">
                            <i class="bi bi-people"></i> Users
                        </a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page" th:text="${user.username}">
                        User
                    </li>
                </ol>
            </nav>
            <h1 class="h2">
                <i class="bi bi-person-circle text-spring-green"></i>
                <span th:text="${user.username}">Username</span>
            </h1>
        </div>
        <div class="btn-toolbar mb-2 mb-md-0">
            <a th:href="@{/users/{id}/edit(id=${user.id})}" class="btn btn-sm btn-primary me-2">
                <i class="bi bi-pencil"></i> Edit User
            </a>
            <a th:href="@{/users}" class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>
        </div>
    </div>

    <!-- Success Message -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill"></i>
        <span th:text="${success}">Success message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Error Message -->
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill"></i>
        <span th:text="${error}">Error message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- User Details -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-spring-green text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-info-circle"></i> User Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong><i class="bi bi-person"></i> Username:</strong>
                        </div>
                        <div class="col-md-8">
                            <span th:text="${user.username}">admin</span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong><i class="bi bi-envelope"></i> Email:</strong>
                        </div>
                        <div class="col-md-8">
                            <span th:text="${user.email ?: 'N/A'}">admin@example.com</span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong><i class="bi bi-shield-check"></i> Role:</strong>
                        </div>
                        <div class="col-md-8">
                            <span class="badge"
                                  th:classappend="${user.role.name() == 'ADMIN'} ? 'bg-danger' : 'bg-secondary'"
                                  th:text="${user.role}">
                                ADMIN
                            </span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong><i class="bi bi-toggle-on"></i> Status:</strong>
                        </div>
                        <div class="col-md-8">
                            <span th:if="${user.isActive}" class="badge bg-success">
                                <i class="bi bi-check-circle"></i> Active
                            </span>
                            <span th:unless="${user.isActive}" class="badge bg-secondary">
                                <i class="bi bi-x-circle"></i> Inactive
                            </span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong><i class="bi bi-calendar-plus"></i> Created:</strong>
                        </div>
                        <div class="col-md-8">
                            <span th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd HH:mm:ss')}">
                                2025-01-09 12:00:00
                            </span>
                        </div>
                    </div>

                    <div class="row mb-3" th:if="${user.updatedAt != null}">
                        <div class="col-md-4">
                            <strong><i class="bi bi-calendar-check"></i> Last Updated:</strong>
                        </div>
                        <div class="col-md-8">
                            <span th:text="${#temporals.format(user.updatedAt, 'yyyy-MM-dd HH:mm:ss')}">
                                2025-01-09 14:30:00
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="card mt-4 border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-exclamation-triangle"></i> Danger Zone
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Warning for last admin -->
                    <div th:if="${isLastAdmin}" class="alert alert-warning" role="alert">
                        <i class="bi bi-shield-exclamation"></i>
                        <strong>Cannot delete!</strong> This is the last ADMIN user in the system.
                        At least one ADMIN must exist to manage the system.
                    </div>

                    <p class="text-muted">
                        Deleting this user will permanently remove all their data. This action cannot be undone.
                    </p>
                    <form th:action="@{/users/{id}/delete(id=${user.id})}" method="post"
                          onsubmit="return confirm('Are you sure you want to delete this user? This action cannot be undone.');">
                        <button type="submit"
                                th:classappend="${isLastAdmin} ? 'btn-secondary' : 'btn-danger'"
                                th:disabled="${isLastAdmin}"
                                class="btn">
                            <i class="bi bi-trash"></i> Delete User
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Side Panel -->
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-lightbulb text-spring-green"></i> User Roles
                    </h5>
                </div>
                <div class="card-body">
                    <h6>ADMIN</h6>
                    <p class="small">
                        Full access to all features including user management, project management,
                        version management, and documentation management.
                    </p>

                    <h6>VIEWER</h6>
                    <p class="small">
                        View-only access to the system. Can browse documentation and projects but
                        cannot make any modifications.
                    </p>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header bg-spring-green text-white">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-info-circle"></i> Security Info
                    </h6>
                </div>
                <div class="card-body">
                    <p class="small">
                        <i class="bi bi-shield-check text-success"></i>
                        <strong>Password:</strong> Encrypted using bcrypt
                    </p>
                    <p class="small">
                        <i class="bi bi-key text-primary"></i>
                        <strong>Authentication:</strong> Spring Security
                    </p>
                    <p class="small mb-0">
                        <i class="bi bi-lock text-warning"></i>
                        <strong>Sessions:</strong> Managed by server
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom Styles -->
<th:block layout:fragment="scripts">
    <style>
        .bg-spring-green {
            background-color: #6db33f;
        }

        .text-spring-green {
            color: #6db33f;
        }

        .breadcrumb-item + .breadcrumb-item::before {
            color: #6c757d;
        }

        .breadcrumb-item.active {
            color: #6db33f;
        }
    </style>
</th:block>
</body>
</html>
